#!/bin/sh
#
# Git Pre-Commit Hook - AI06 Service Protection
#
# This hook prevents committing code that disables the AI06 WebSocket service.
# To install: Copy to .git/hooks/pre-commit and make executable
#
# Installation:
#   cp .git-hooks/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit

echo "üîç Checking AI06 WebSocket Service configuration..."

# Check if backend/.env is being committed
if git diff --cached --name-only | grep -q "backend/.env"; then
  # Check if AI06_WEBSOCKET_ENABLED is set to false
  if git diff --cached backend/.env | grep -q "AI06_WEBSOCKET_ENABLED=false"; then
    echo ""
    echo "‚ùå COMMIT BLOCKED!"
    echo ""
    echo "You are trying to commit AI06_WEBSOCKET_ENABLED=false"
    echo "This will disable device connections!"
    echo ""
    echo "If this is intentional, remove this check from .git/hooks/pre-commit"
    echo ""
    exit 1
  fi
fi

# Check if server.js is being committed with commented AI06 service
if git diff --cached --name-only | grep -q "backend/server.js"; then
  # Check if AI06 service is commented out
  if git diff --cached backend/server.js | grep -q "// const AI06WebSocketService"; then
    echo ""
    echo "‚ùå COMMIT BLOCKED!"
    echo ""
    echo "You are trying to commit commented-out AI06 WebSocket Service code"
    echo "This will disable device connections!"
    echo ""
    echo "Uncomment the AI06 service code in backend/server.js"
    echo ""
    exit 1
  fi
fi

echo "‚úÖ AI06 WebSocket Service configuration is safe"
exit 0
