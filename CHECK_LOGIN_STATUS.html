<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Login Status</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .status-box {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            background: #f8f9ff;
        }
        .status-box.error {
            border-left-color: #e74c3c;
            background: #fff5f5;
        }
        .status-box.success {
            border-left-color: #27ae60;
            background: #f0fff4;
        }
        .status-box.warning {
            border-left-color: #f39c12;
            background: #fffbf0;
        }
        .label {
            font-weight: bold;
            color: #555;
            margin-top: 10px;
        }
        .value {
            font-family: 'Courier New', monospace;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            margin: 5px 0;
            word-break: break-all;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        button.danger {
            background: #e74c3c;
        }
        button.danger:hover {
            background: #c0392b;
        }
        .actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Login Status Checker</h1>
        
        <div id="status"></div>
        
        <div class="actions">
            <button onclick="checkStatus()">üîÑ Refresh Status</button>
            <button onclick="clearStorage()" class="danger">üóëÔ∏è Clear All & Logout</button>
            <button onclick="goToLogin()">üîê Go to Login</button>
        </div>
    </div>

    <script>
        function checkStatus() {
            const statusDiv = document.getElementById('status');
            let html = '';
            
            // Check if logged in
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userType = localStorage.getItem('userType');
            const token = localStorage.getItem('authToken');
            
            // Overall status
            if (isLoggedIn && token) {
                html += '<div class="status-box success">';
                html += '<h2>‚úÖ You are logged in</h2>';
                html += '</div>';
            } else {
                html += '<div class="status-box error">';
                html += '<h2>‚ùå You are NOT logged in</h2>';
                html += '<p>Please log in to access the system.</p>';
                html += '</div>';
            }
            
            // User Type
            html += '<div class="status-box">';
            html += '<div class="label">User Type:</div>';
            html += '<div class="value">' + (userType || 'Not set') + '</div>';
            
            if (userType === 'staff') {
                html += '<div class="status-box warning" style="margin-top: 10px;">';
                html += '<strong>‚ö†Ô∏è Warning:</strong> You are logged in as STAFF. Staff users do not have access to finance features.';
                html += '<br><strong>Solution:</strong> Log out and log in as an ADMIN user.';
                html += '</div>';
            } else if (userType === 'admin') {
                html += '<div class="status-box success" style="margin-top: 10px;">';
                html += '<strong>‚úÖ Good:</strong> You are logged in as ADMIN. You should have access to finance features.';
                html += '</div>';
            }
            html += '</div>';
            
            // Token
            html += '<div class="status-box">';
            html += '<div class="label">Auth Token:</div>';
            if (token) {
                html += '<div class="value">' + token.substring(0, 50) + '... (truncated)</div>';
                html += '<div style="margin-top: 10px; color: #27ae60;">‚úì Token exists</div>';
            } else {
                html += '<div class="value" style="color: #e74c3c;">No token found</div>';
            }
            html += '</div>';
            
            // Admin User Data
            const adminUser = localStorage.getItem('adminUser');
            if (adminUser) {
                try {
                    const user = JSON.parse(adminUser);
                    html += '<div class="status-box">';
                    html += '<div class="label">Admin User Data:</div>';
                    html += '<pre>' + JSON.stringify(user, null, 2) + '</pre>';
                    
                    if (user.role) {
                        html += '<div style="margin-top: 10px;">';
                        html += '<strong>Role:</strong> ' + user.role;
                        
                        if (user.role === 'admin' || user.role === 'director' || user.role === 'super_admin') {
                            html += ' <span style="color: #27ae60;">‚úì Has finance access</span>';
                        } else {
                            html += ' <span style="color: #e74c3c;">‚úó No finance access</span>';
                        }
                        html += '</div>';
                    }
                    html += '</div>';
                } catch (e) {
                    html += '<div class="status-box error">';
                    html += '<div class="label">Admin User Data:</div>';
                    html += '<div class="value">Invalid JSON data</div>';
                    html += '</div>';
                }
            }
            
            // Staff User Data
            const staffUser = localStorage.getItem('staffUser');
            if (staffUser) {
                try {
                    const user = JSON.parse(staffUser);
                    html += '<div class="status-box">';
                    html += '<div class="label">Staff User Data:</div>';
                    html += '<pre>' + JSON.stringify(user, null, 2) + '</pre>';
                    
                    html += '<div class="status-box warning" style="margin-top: 10px;">';
                    html += '<strong>‚ö†Ô∏è Note:</strong> Staff users (teachers, general staff) do not have access to finance features by default.';
                    html += '</div>';
                    html += '</div>';
                } catch (e) {
                    html += '<div class="status-box error">';
                    html += '<div class="label">Staff User Data:</div>';
                    html += '<div class="value">Invalid JSON data</div>';
                    html += '</div>';
                }
            }
            
            // Recommendations
            html += '<div class="status-box">';
            html += '<h3>üìã Recommendations:</h3>';
            html += '<ul>';
            
            if (!isLoggedIn || !token) {
                html += '<li>You need to log in first</li>';
            } else if (userType === 'staff') {
                html += '<li><strong>Log out and log in as an ADMIN</strong> to access finance features</li>';
                html += '<li>Staff users do not have finance permissions</li>';
            } else if (userType === 'admin') {
                html += '<li>You should have access to finance features</li>';
                html += '<li>If you still get 403 errors, make sure the backend server is running</li>';
                html += '<li>Try refreshing the page or clearing cache</li>';
            } else {
                html += '<li>Unknown user type - please log in again</li>';
            }
            
            html += '</ul>';
            html += '</div>';
            
            statusDiv.innerHTML = html;
        }
        
        function clearStorage() {
            if (confirm('This will log you out and clear all stored data. Continue?')) {
                localStorage.clear();
                alert('All data cleared. You have been logged out.');
                checkStatus();
            }
        }
        
        function goToLogin() {
            window.location.href = 'http://localhost:5173/login';
        }
        
        // Check status on page load
        checkStatus();
    </script>
</body>
</html>
